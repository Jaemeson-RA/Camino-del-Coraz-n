<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Camino del Coraz√≥n üíï</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ffc9de 0%, #ffb3d1 100%);
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: pan-y;
        }

        #gameContainer {
            max-width: 600px;
            margin: 0 auto;
            padding: 10px;
            position: relative;
            z-index: 1;
        }

        #header {
            text-align: center;
            color: #d81159;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        #header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        #playerInfo {
            display: flex;
            justify-content: space-around;
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .player {
            text-align: center;
            transition: all 0.3s;
        }

        .player.active {
            transform: scale(1.1);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1.1); }
            50% { transform: scale(1.15); }
        }

        .playerName {
            font-weight: bold;
            color: #d81159;
            font-size: 1.2em;
        }

        .playerPoints {
            font-size: 1.5em;
            color: #ff6b9d;
        }

        #rollButton {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #ff6b9d, #ff1493);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        #rollButton:active {
            transform: scale(0.98);
        }

        #rollButton:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #diceContainer {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .dice {
            width: 80px;
            height: 80px;
            background: white;
            border: 3px solid #ff6b9d;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .dice:active {
            transform: scale(0.95);
        }

        .dice.rolling {
            animation: roll 0.5s ease-in-out;
        }

        @keyframes roll {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #boardContainer {
            position: relative;
            background: linear-gradient(135deg, #ffe5f0 0%, #ffd5e8 100%);
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        /* D√©coration de fond avec des c≈ìurs */
        #boardContainer::before {
            content: 'üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï üíï';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            font-size: 20px;
            color: rgba(255, 107, 157, 0.15);
            word-wrap: break-word;
            z-index: 1;
            pointer-events: none;
            line-height: 2;
        }

        #board {
            position: relative;
            min-height: 600px;
            z-index: 2;
        }

        /* Canvas pour le chemin */
        #pathCanvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 1;
        }

        .boardCell {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            border: 3px solid #ff6b9d;
            border-radius: 15px;
            padding: 8px;
            font-size: 0.7em;
            color: #d81159;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            width: 85px;
            height: 85px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            line-height: 1.2;
            font-weight: 600;
            z-index: 2;
            word-wrap: break-word;
            overflow: hidden;
        }

        .boardCell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .boardCell.reto-verdad {
            background: linear-gradient(135deg, rgba(255, 204, 224, 0.95) 50%, rgba(201, 240, 255, 0.95) 50%);
            font-weight: bold;
        }

        .boardCell.meta {
            background: #ff1493;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
            border: 3px solid #d81159;
            width: 90px;
            height: 90px;
        }

        .boardCell.inicio {
            background: #ffd700;
            color: #d81159;
            font-weight: bold;
            font-size: 0.9em;
            border: 3px solid #d81159;
        }

        .pion {
            position: absolute;
            width: 45px;
            height: 45px;
            cursor: grab;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 100;
            font-size: 2.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4));
        }

        .pion:active {
            cursor: grabbing;
        }

        .pion.moving {
            animation: bounce 0.5s ease-in-out;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-25px) scale(1.2); }
        }

        /* Modals avec z-index corrig√©s */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 2000;
            padding: 20px;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modalContent {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            animation: slideIn 0.3s ease-out;
            position: relative;
            z-index: 2001;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        #questionText {
            font-size: 1.3em;
            color: #d81159;
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
        }

        #answerInput {
            width: 100%;
            padding: 15px;
            border: 2px solid #ff6b9d;
            border-radius: 10px;
            font-size: 1.1em;
            margin-bottom: 15px;
            resize: vertical;
        }

        .modalButtons {
            display: flex;
            gap: 10px;
        }

        .modalButton {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modalButton.validate {
            background: #4CAF50;
            color: white;
        }

        .modalButton.reject {
            background: #f44336;
            color: white;
        }

        .modalButton.submit {
            background: #ff6b9d;
            color: white;
        }

        .modalButton:active {
            transform: scale(0.95);
        }

        #bonusContent {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            animation: bounceIn 0.5s ease-out;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        #bonusContent h2 {
            font-size: 2em;
            color: #d81159;
            margin-bottom: 15px;
        }

        #bonusContent p {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
        }

        #choiceContent h3 {
            color: #d81159;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .choiceButtons {
            display: flex;
            gap: 15px;
        }

        .choiceButton {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .choiceButton.reto {
            background: linear-gradient(135deg, #ff6b9d, #ff1493);
            color: white;
        }

        .choiceButton.verdad {
            background: linear-gradient(135deg, #4fc3f7, #0288d1);
            color: white;
        }

        .choiceButton:active {
            transform: scale(0.95);
        }

        #gameOverContent h2 {
            color: #d81159;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        #gameOverContent p {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 30px;
        }

        #restartButton {
            padding: 15px 40px;
            background: linear-gradient(135deg, #ff6b9d, #ff1493);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
        }

        #validationAnswer {
            margin: 20px 0;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 10px;
            font-size: 1.1em;
            color: #333;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="header">
            <h1>üíï Camino del Coraz√≥n üíï</h1>
        </div>

        <div id="playerInfo">
            <div class="player active" id="player1Info">
                <div class="playerName">Alejandra üë©</div>
                <div class="playerPoints">0 pts</div>
            </div>
            <div class="player" id="player2Info">
                <div class="playerName">Jaemeson üë®</div>
                <div class="playerPoints">0 pts</div>
            </div>
        </div>

        <button id="rollButton">üé≤ Tirar los dados üé≤</button>

        <div id="diceContainer">
            <div class="dice" id="dice1">?</div>
            <div class="dice" id="dice2">?</div>
        </div>

        <div id="boardContainer">
            <canvas id="pathCanvas"></canvas>
            <div id="board">
                <div id="pion1" class="pion">üë©</div>
                <div id="pion2" class="pion">üë®</div>
            </div>
        </div>
    </div>

    <!-- Modal pour les questions -->
    <div id="questionModal" class="modal">
        <div class="modalContent">
            <h3 id="questionText"></h3>
            <textarea id="answerInput" placeholder="Escribe tu respuesta aqu√≠..." rows="4"></textarea>
            <div class="modalButtons">
                <button class="modalButton submit" id="submitAnswer">Enviar respuesta</button>
            </div>
        </div>
    </div>

    <!-- Modal pour validation -->
    <div id="validationModal" class="modal">
        <div class="modalContent">
            <h3 id="validationQuestion"></h3>
            <div id="validationAnswer"></div>
            <div class="modalButtons">
                <button class="modalButton validate">‚úì Correcto</button>
                <button class="modalButton reject">‚úó Incorrecto</button>
            </div>
        </div>
    </div>

    <!-- Modal bonus -->
    <div id="bonusModal" class="modal">
        <div id="bonusContent">
            <h2>üéâ ¬°DOBLE! üéâ</h2>
            <p id="bonusText"></p>
            <button class="modalButton submit" onclick="closeBonus()">¬°Genial!</button>
        </div>
    </div>

    <!-- Modal choix Reto/Verdad -->
    <div id="choiceModal" class="modal">
        <div class="modalContent" id="choiceContent">
            <h3>Elige tu destino üéØ</h3>
            <div class="choiceButtons">
                <button class="choiceButton reto" onclick="chooseType('reto')">RETO üî•</button>
                <button class="choiceButton verdad" onclick="chooseType('verdad')">VERDAD üí¨</button>
            </div>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="gameOver" class="modal">
        <div class="modalContent" id="gameOverContent">
            <h2>üíï ¬°FIN DEL JUEGO! üíï</h2>
            <p id="winnerText"></p>
            <button id="restartButton">Jugar de nuevo</button>
        </div>
    </div>

    <script>
        // Configuration du jeu
        const PREGUNTAS = [
            { pregunta: "Color favorito üé®", type: "normal", points: 1 },
            { pregunta: "Comida preferida üçï", type: "normal", points: 1 },
            { pregunta: "Pel√≠cula favorita üé¨", type: "normal", points: 1 },
            { pregunta: "Mayor sue√±o que tienes", type: "normal", points: 1 },
            { pregunta: "Donde viajar conmigo ‚úàÔ∏è", type: "normal", points: 1 },
            { pregunta: "Posici√≥n favorita en la cama üòè", type: "normal", points: 1 },
            { pregunta: "Canci√≥n que te hace pensar en m√≠ üéµ", type: "normal", points: 1 },
            { pregunta: "Si pudieras tener un superpoder ‚ö°", type: "normal", points: 1 },
            { pregunta: "¬øQu√© te enamora de m√≠? ‚ù§Ô∏è", type: "normal", points: 1 },
            { pregunta: "Retrocede 2 casillas üòä", type: "normal", points: 1 },
            { pregunta: "Foto tuya con cara divertida üòú", type: "normal", points: 1 },
            { pregunta: "¬øQu√© ropa te hace sentir sexy? üëó", type: "normal", points: 1 },
            { pregunta: "Tu ciudad preferida üèôÔ∏è", type: "normal", points: 1 },
            { pregunta: "Algo que te da mucha risa üòÇ", type: "normal", points: 1 },
            { pregunta: "Tu bebida favorita üçπ", type: "normal", points: 1 },
            { pregunta: "Lo que m√°s valoras de nuestra relaci√≥n üíë", type: "normal", points: 1 },
            { pregunta: "Pregunta lo que quieras üí≠", type: "normal", points: 1 },
            { pregunta: "Algo que te gustar√≠a que hici√©ramos juntos", type: "normal", points: 1 },
            { pregunta: "Tu recuerdo m√°s embarazoso üôà", type: "normal", points: 1 },
            { pregunta: "Describe tu cita perfecta üíï", type: "normal", points: 1 },
            { pregunta: "¬øRETO o VERDAD?", type: "reto-verdad", points: 2 },
            { pregunta: "Retrocede 2 casillas üòä", type: "normal", points: 1 },
            { pregunta: "Algo que te gustar√≠a que hiciera m√°s", type: "normal", points: 1 },
            { pregunta: "Una fantas√≠a tuya üòè", type: "normal", points: 1 },
            { pregunta: "Una palabra que me describa üí¨", type: "normal", points: 1 },
            { pregunta: "Cu√©ntame un recuerdo de infancia üéà", type: "normal", points: 1 },
            { pregunta: "Lugar donde te gustar√≠a besarme üíã", type: "normal", points: 1 },
            { pregunta: "Algo siempre quisiste probar conmigo", type: "normal", points: 1 },
            { pregunta: "Tu peor cita üò¨", type: "normal", points: 1 },
            { pregunta: "¬øQu√© parte de mi cuerpo te gusta m√°s? üëÄ", type: "normal", points: 1 },
            { pregunta: "Un cumplido sincero üåü", type: "normal", points: 1 },
            { pregunta: "Describe nuestro primer beso üíã", type: "normal", points: 1 }
        ];

        const BONUS_OPTIONS = [
            "Juega una segunda vez üé≤",
            "+ 5 puntos üåü",
            "Avanza de 1 casilla ‚û°Ô∏è",
            "Verdad absoluta: pose una pregunta, no puede mentir üí¨"
        ];

        // √âtat du jeu
        let gameState = {
            currentPlayer: 1,
            players: {
                1: { name: "Alejandra", points: 0, position: 0 },
                2: { name: "Jaemeson", points: 0, position: 0 }
            },
            dice1: 0,
            dice2: 0,
            canRoll: true,
            currentQuestion: null,
            currentAnswer: "",
            boardSize: 32,
            currentChosenType: null,
            cellPositions: []
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            createBoard();
            drawPath();
            updateUI();
            setupEventListeners();
            positionPions();
        });

        function createBoard() {
            const board = document.getElementById('board');
            
            // Cr√©er un chemin en spirale ORGANIQUE avec variation naturelle
            // Positions calcul√©es pour √©viter les chevauchements
            const path = [
                // D√âBUT - Coin bas gauche
                {x: 20, y: 495},
                
                // Ligne du bas - vers la droite
                {x: 115, y: 500},
                {x: 208, y: 493},
                {x: 305, y: 498},
                {x: 400, y: 492},
                {x: 495, y: 497},
                
                // Colonne droite - monte
                {x: 492, y: 400},
                {x: 498, y: 305},
                {x: 493, y: 210},
                {x: 497, y: 115},
                
                // Ligne du haut - vers la gauche
                {x: 402, y: 20},
                {x: 307, y: 25},
                {x: 212, y: 18},
                {x: 117, y: 23},
                {x: 22, y: 20},
                
                // Colonne gauche - descend
                {x: 25, y: 115},
                {x: 20, y: 210},
                {x: 25, y: 305},
                {x: 22, y: 400},
                
                // 2√®me couche - ligne du bas
                {x: 117, y: 405},
                {x: 212, y: 400},
                {x: 307, y: 403},
                {x: 400, y: 398},
                
                // 2√®me couche - colonne droite
                {x: 403, y: 305},
                {x: 398, y: 212},
                
                // 2√®me couche - ligne du haut
                {x: 307, y: 115},
                {x: 212, y: 110},
                {x: 120, y: 113},
                
                // 2√®me couche - colonne gauche
                {x: 115, y: 208},
                
                // Centre - spirale finale
                {x: 210, y: 210},
                {x: 305, y: 208},
                
                // META au centre
                {x: 257, y: 257}
            ];

            gameState.cellPositions = path;

            path.forEach((pos, index) => {
                const cell = document.createElement('div');
                cell.className = 'boardCell';
                cell.dataset.position = index;
                cell.style.left = pos.x + 'px';
                cell.style.top = pos.y + 'px';
                
                if (index === 0) {
                    cell.classList.add('inicio');
                    cell.innerHTML = '<div style="font-size: 1.1em; font-weight: bold;">INICIO</div><div style="font-size: 1.3em;">‚≠ê</div>';
                } else if (index === path.length - 1) {
                    cell.classList.add('meta');
                    cell.innerHTML = '<div style="font-size: 1.3em; font-weight: bold;">META</div><div style="font-size: 1.5em;">üíï</div>';
                } else if (PREGUNTAS[index - 1].type === 'reto-verdad') {
                    cell.classList.add('reto-verdad');
                    cell.innerHTML = '<div style="font-size: 0.9em; line-height: 1.1;">RETO<br>/<br>VERDAD</div>';
                } else {
                    // Afficher plus de texte
                    const fullText = PREGUNTAS[index - 1].pregunta;
                    const shortText = fullText.length > 28 ? fullText.substring(0, 26) + '...' : fullText;
                    cell.innerHTML = `<div style="font-size: 0.85em; line-height: 1.2; padding: 2px;">${shortText}</div>`;
                }
                
                board.appendChild(cell);
            });
        }

        function drawPath() {
            const canvas = document.getElementById('pathCanvas');
            const board = document.getElementById('board');
            canvas.width = board.offsetWidth;
            canvas.height = board.offsetHeight;
            const ctx = canvas.getContext('2d');

            // Dessiner le chemin
            ctx.strokeStyle = '#ff6b9d';
            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.setLineDash([12, 8]);

            ctx.beginPath();
            gameState.cellPositions.forEach((pos, index) => {
                const x = pos.x + 42.5; // Centre de la case (85/2)
                const y = pos.y + 42.5;
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // Dessiner des petits c≈ìurs le long du chemin
            ctx.font = '16px Arial';
            for (let i = 0; i < gameState.cellPositions.length - 1; i++) {
                const pos1 = gameState.cellPositions[i];
                const pos2 = gameState.cellPositions[i + 1];
                const midX = (pos1.x + pos2.x) / 2 + 42.5;
                const midY = (pos1.y + pos2.y) / 2 + 42.5;
                
                if (i % 3 === 0) { // Un c≈ìur tous les 3 segments
                    ctx.fillStyle = 'rgba(255, 107, 157, 0.4)';
                    ctx.fillText('üíï', midX - 8, midY + 5);
                }
            }
        }

        function setupEventListeners() {
            document.getElementById('rollButton').addEventListener('click', rollDice);
            document.getElementById('submitAnswer').addEventListener('click', submitAnswer);
            document.getElementById('restartButton').addEventListener('click', restartGame);
            
            const validateBtn = document.querySelector('.modalButton.validate');
            const rejectBtn = document.querySelector('.modalButton.reject');
            
            if (validateBtn) validateBtn.addEventListener('click', () => validateAnswer(true));
            if (rejectBtn) rejectBtn.addEventListener('click', () => validateAnswer(false));

            // Drag and drop pour les pions
            setupPionDrag('pion1');
            setupPionDrag('pion2');
        }

        function setupPionDrag(pionId) {
            const pion = document.getElementById(pionId);
            let isDragging = false;
            let startX, startY, initialLeft, initialTop;

            pion.addEventListener('touchstart', (e) => {
                isDragging = true;
                const touch = e.touches[0];
                startX = touch.clientX;
                startY = touch.clientY;
                initialLeft = pion.offsetLeft;
                initialTop = pion.offsetTop;
                pion.style.transition = 'none';
                e.preventDefault();
            });

            pion.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                const touch = e.touches[0];
                const deltaX = touch.clientX - startX;
                const deltaY = touch.clientY - startY;
                pion.style.left = (initialLeft + deltaX) + 'px';
                pion.style.top = (initialTop + deltaY) + 'px';
                e.preventDefault();
            });

            pion.addEventListener('touchend', (e) => {
                isDragging = false;
                pion.style.transition = 'all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
                e.preventDefault();
            });
        }

        function rollDice() {
            if (!gameState.canRoll) return;
            
            gameState.canRoll = false;
            const dice1 = document.getElementById('dice1');
            const dice2 = document.getElementById('dice2');
            
            dice1.classList.add('rolling');
            dice2.classList.add('rolling');
            
            let rolls = 0;
            const interval = setInterval(() => {
                dice1.textContent = Math.floor(Math.random() * 6) + 1;
                dice2.textContent = Math.floor(Math.random() * 6) + 1;
                rolls++;
                
                if (rolls >= 10) {
                    clearInterval(interval);
                    gameState.dice1 = Math.floor(Math.random() * 6) + 1;
                    gameState.dice2 = Math.floor(Math.random() * 6) + 1;
                    dice1.textContent = gameState.dice1;
                    dice2.textContent = gameState.dice2;
                    dice1.classList.remove('rolling');
                    dice2.classList.remove('rolling');
                    
                    // V√©rifier si c'est un double
                    if (gameState.dice1 === gameState.dice2) {
                        showBonus();
                    } else {
                        movePion();
                    }
                }
            }, 100);
        }

        function showBonus() {
            const bonus = BONUS_OPTIONS[Math.floor(Math.random() * BONUS_OPTIONS.length)];
            document.getElementById('bonusText').textContent = bonus;
            document.getElementById('bonusModal').classList.add('show');
            
            // Appliquer le bonus
            if (bonus.includes("5 puntos")) {
                gameState.players[gameState.currentPlayer].points += 5;
            } else if (bonus.includes("Avanza")) {
                gameState.players[gameState.currentPlayer].position += 1;
            }
            
            setTimeout(() => {
                closeBonus();
                movePion();
            }, 3000);
        }

        function closeBonus() {
            document.getElementById('bonusModal').classList.remove('show');
        }

        function movePion() {
            const totalMove = gameState.dice1 + gameState.dice2;
            const currentPos = gameState.players[gameState.currentPlayer].position;
            const newPos = Math.min(currentPos + totalMove, gameState.boardSize - 1);
            
            gameState.players[gameState.currentPlayer].position = newPos;
            
            // Animer le pion
            const pionId = 'pion' + gameState.currentPlayer;
            const pion = document.getElementById(pionId);
            pion.classList.add('moving');
            
            setTimeout(() => {
                positionPions();
                pion.classList.remove('moving');
                
                // V√©rifier si le joueur a atteint la fin
                if (newPos === gameState.boardSize - 1) {
                    endGame();
                } else {
                    showQuestion(newPos);
                }
            }, 600);
        }

        function positionPions() {
            Object.keys(gameState.players).forEach(playerNum => {
                const player = gameState.players[playerNum];
                const pion = document.getElementById('pion' + playerNum);
                const pos = gameState.cellPositions[player.position];
                
                if (pos) {
                    // Offset pour √©viter la superposition
                    const offset = playerNum === "1" ? -10 : 15;
                    
                    pion.style.left = (pos.x + 20 + offset) + 'px';
                    pion.style.top = (pos.y + 20) + 'px';
                }
            });
        }

        function showQuestion(position) {
            if (position === 0) {
                nextTurn();
                return;
            }
            
            const pregunta = PREGUNTAS[position - 1];
            
            if (pregunta.type === 'reto-verdad') {
                document.getElementById('choiceModal').classList.add('show');
                return;
            }
            
            gameState.currentQuestion = pregunta;
            document.getElementById('questionText').textContent = pregunta.pregunta;
            document.getElementById('answerInput').value = '';
            document.getElementById('questionModal').classList.add('show');
        }

        function chooseType(type) {
            document.getElementById('choiceModal').classList.remove('show');
            gameState.currentChosenType = type;
            
            // Cr√©er une question bas√©e sur le type
            const question = type === 'reto' ? 
                "RETO: Haz algo atrevido y descr√≠belo üî•" : 
                "VERDAD: Responde con sinceridad absoluta üí¨";
            
            gameState.currentQuestion = { pregunta: question, type: "reto-verdad", points: 2 };
            document.getElementById('questionText').textContent = question;
            document.getElementById('answerInput').value = '';
            document.getElementById('questionModal').classList.add('show');
        }

        function submitAnswer() {
            gameState.currentAnswer = document.getElementById('answerInput').value;
            
            if (!gameState.currentAnswer.trim()) {
                alert('Por favor escribe una respuesta');
                return;
            }
            
            document.getElementById('questionModal').classList.remove('show');
            
            // Montrer la modal de validation √† l'autre joueur
            document.getElementById('validationQuestion').textContent = gameState.currentQuestion.pregunta;
            document.getElementById('validationAnswer').textContent = gameState.currentAnswer;
            document.getElementById('validationModal').classList.add('show');
        }

        function validateAnswer(isCorrect) {
            document.getElementById('validationModal').classList.remove('show');
            
            if (isCorrect) {
                gameState.players[gameState.currentPlayer].points += gameState.currentQuestion.points;
            }
            
            updateUI();
            nextTurn();
        }

        function nextTurn() {
            gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1;
            gameState.canRoll = true;
            updateUI();
        }

        function updateUI() {
            // Mettre √† jour les points
            document.querySelector('#player1Info .playerPoints').textContent = 
                gameState.players[1].points + ' pts';
            document.querySelector('#player2Info .playerPoints').textContent = 
                gameState.players[2].points + ' pts';
            
            // Mettre √† jour le joueur actif
            document.getElementById('player1Info').classList.toggle('active', gameState.currentPlayer === 1);
            document.getElementById('player2Info').classList.toggle('active', gameState.currentPlayer === 2);
            
            // Mettre √† jour le bouton
            document.getElementById('rollButton').disabled = !gameState.canRoll;
        }

        function endGame() {
            const winner = gameState.players[1].points > gameState.players[2].points ? 
                gameState.players[1] : gameState.players[2];
            
            document.getElementById('winnerText').innerHTML = 
                `<strong>${winner.name}</strong> ha ganado con <strong>${winner.points}</strong> puntos! üéâ<br><br>` +
                `Alejandra: ${gameState.players[1].points} pts<br>` +
                `Jaemeson: ${gameState.players[2].points} pts`;
            
            document.getElementById('gameOver').classList.add('show');
        }

        function restartGame() {
            gameState = {
                currentPlayer: 1,
                players: {
                    1: { name: "Alejandra", points: 0, position: 0 },
                    2: { name: "Jaemeson", points: 0, position: 0 }
                },
                dice1: 0,
                dice2: 0,
                canRoll: true,
                currentQuestion: null,
                currentAnswer: "",
                boardSize: 32,
                currentChosenType: null,
                cellPositions: gameState.cellPositions
            };
            
            document.getElementById('dice1').textContent = '?';
            document.getElementById('dice2').textContent = '?';
            document.getElementById('gameOver').classList.remove('show');
            positionPions();
            updateUI();
        }
    </script>
</body>
</html>
